# vim: set ft=haproxy :
frontend public
	bind :80
  mode http
  timeout client 1m
	acl GRAPHQL path_beg /graphql
	acl CMS path_beg /cms
	use_backend api if GRAPHQL
	use_backend cms if CMS
	default_backend web

backend web
  mode http
  timeout connect         10s
  timeout server          1m
	server web web:80 cookie web

backend api
  mode http
  timeout connect         10s
  timeout server          1m
	server api api:3000 cookie api

backend cms
  mode http
  timeout connect         10s
  timeout server          1m
	server cms cms:3000 cookie api
